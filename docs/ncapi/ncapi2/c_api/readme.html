<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <link rel="stylesheet" href="../../../assets/css/style.css">
    <script src="../../../assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header  class="without-description" >
        <h1 style="color:#FFFFFF;text-shadow:none"><a href=../../../index.html>Intel® Movidius™ Neural Compute SDK</a></h1>
        
        <p class="view"><a href="">View the Project on GitHub <small></small></a></p>
        <ul>
        
          <li>  <a href=../../../TOC.html><small>Table of Contents</small></a> </li>
          <li>  <a href=../../../index.html#NcSdkTools><small>NCSDK<br>Tools</small></a> </li>
          <li> <a href=../../../ncapi/readme.html><small>NCAPI Documentation</small></a></li>
          <li>  <a href="">View On <strong>GitHub</strong></a></li>
          <li> <a href="https://ncsforum.movidius.com/">User Forum</a></li>
        </ul>
      </header>

      <section>

      <h1 id="intel-movidius-neural-compute-sdk-c-api">Intel® Movidius™ Neural Compute SDK C API</h1>

<p>The Intel® Movidius™ Neural Compute SDK (Intel® Movidius™ NCSDK) comes with a C language API (API) that enables developers to create applications in C or C++ that utilize hardware-accelerated Deep Neural Networks via neural compute devices like the <a href="../../../ncs.html">Intel® Movidius™ Neural Compute Stick</a>.
The C API is provided as a header file (mvnc.h) and an associated library file (libmvnc.so), both of which are placed on the development computer when the NCSDK is installed.</p>

<h2 id="documentation">Documentation</h2>

<table>
  <thead>
    <tr>
      <th>Enumerations</th>
      <th> </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="ncDeviceHwVersion_t.html">ncDeviceHwVersion_t</a></td>
      <td>Contains neural compute device hardware versions.</td>
    </tr>
    <tr>
      <td><a href="ncDeviceOption_t.html">ncDeviceOption_t</a></td>
      <td>Contains neural compute device options.</td>
    </tr>
    <tr>
      <td><a href="ncDeviceState_t.html">ncDeviceState_t</a></td>
      <td>Contains neural compute device NCAPI states.</td>
    </tr>
    <tr>
      <td><a href="ncFifoDataType_t.html">ncFifoDataType_t</a></td>
      <td>Contains FIFO queue element data types.</td>
    </tr>
    <tr>
      <td><a href="ncFifoOption_t.html">ncFifoOption_t</a></td>
      <td>Contains FIFO queue options.</td>
    </tr>
    <tr>
      <td><a href="ncFifoState_t.html">ncFifoState_t</a></td>
      <td>Contains FIFO queue NCAPI states.</td>
    </tr>
    <tr>
      <td><a href="ncFifoType_t.html">ncFifoType_t</a></td>
      <td>Contains FIFO queue access types.</td>
    </tr>
    <tr>
      <td><a href="ncGlobalOption_t.html">ncGlobalOption_t</a></td>
      <td>Contains global (application-level) options.</td>
    </tr>
    <tr>
      <td><a href="ncGraphOption_t.html">ncGraphOption_t</a></td>
      <td>Contains network graph options.</td>
    </tr>
    <tr>
      <td><a href="ncGraphState_t.html">ncGraphState_t</a></td>
      <td>Contains network graph NCAPI states.</td>
    </tr>
    <tr>
      <td><a href="ncStatus_t.html">ncStatus_t</a></td>
      <td>Contains status code return values for NCAPI functions.</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th>Structs</th>
      <th> </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="ncDeviceHandle_t.html">struct ncDeviceHandle_t</a></td>
      <td>Holds data and resources corresponding to a neural compute device.</td>
    </tr>
    <tr>
      <td><a href="ncFifoHandle_t.html">struct ncFifoHandle_t</a></td>
      <td>Holds data and resources corresponding to a FIFO queue.</td>
    </tr>
    <tr>
      <td><a href="ncGraphHandle_t.html">struct ncGraphHandle_t</a></td>
      <td>Holds data and resources corresponding to network graph.</td>
    </tr>
    <tr>
      <td><a href="ncTensorDescriptor_t.html">struct ncTensorDescriptor_t</a></td>
      <td>Holds information that describes the shape of a tensor.</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th>Global Functions</th>
      <th> </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="ncGlobalGetOption.html">ncGlobalGetOption</a></td>
      <td>Gets the value of a global option for the application.</td>
    </tr>
    <tr>
      <td><a href="ncGlobalSetOption.html">ncGlobalSetOption</a></td>
      <td>Sets the value of a global option for the application.</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th>Device Functions</th>
      <th> </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="ncDeviceClose.html">ncDeviceClose</a></td>
      <td>Closes communication with a previously opened neural compute device.</td>
    </tr>
    <tr>
      <td><a href="ncDeviceCreate.html">ncDeviceCreate</a></td>
      <td>Initializes a <a href="ncDeviceHandle_t.html">ncDeviceHandle_t</a> struct for use with the NCAPI.</td>
    </tr>
    <tr>
      <td><a href="ncDeviceDestroy.html">ncDeviceDestroy</a></td>
      <td>Destroys a device handle and frees associated resources.</td>
    </tr>
    <tr>
      <td><a href="ncDeviceGetOption.html">ncDeviceGetOption</a></td>
      <td>Gets the value of an option for a neural compute device.</td>
    </tr>
    <tr>
      <td><a href="ncDeviceOpen.html">ncDeviceOpen</a></td>
      <td>Boots and initializes a neural compute device and opens communication.</td>
    </tr>
    <tr>
      <td><a href="ncDeviceSetOption.html">ncDeviceSetOption</a></td>
      <td>Sets the value of an option for a neural compute device.</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th>FIFO Functions</th>
      <th> </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="ncFifoAllocate.html">ncFifoAllocate</a></td>
      <td>Allocates a FIFO buffer for graph input or output.</td>
    </tr>
    <tr>
      <td><a href="ncFifoCreate.html">ncFifoCreate</a></td>
      <td>Initializes a <a href="ncFifoHandle_t.html">ncFifoHandle_t</a> struct for use with the NCAPI.</td>
    </tr>
    <tr>
      <td><a href="ncFifoDestroy.html">ncFifoDestroy</a></td>
      <td>Destroys a FIFO handle and frees associated resources.</td>
    </tr>
    <tr>
      <td><a href="ncFifoGetOption.html">ncFifoGetOption</a></td>
      <td>Gets the value of an option for a FIFO.</td>
    </tr>
    <tr>
      <td><a href="ncFifoReadElem.html">ncFifoReadElem</a></td>
      <td>Reads an element from a FIFO.</td>
    </tr>
    <tr>
      <td><a href="ncFifoRemoveElem.html">ncFifoRemoveElem</a></td>
      <td><em>Not yet implemented.</em></td>
    </tr>
    <tr>
      <td><a href="ncFifoSetOption.html">ncFifoSetOption</a></td>
      <td>Sets the value of an option for a FIFO.</td>
    </tr>
    <tr>
      <td><a href="ncFifoWriteElem.html">ncFifoWriteElem</a></td>
      <td>Writes an element to a FIFO.</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th>Graph Functions</th>
      <th> </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="ncGraphAllocate.html">ncGraphAllocate</a></td>
      <td>Allocates a graph to a neural compute device.</td>
    </tr>
    <tr>
      <td><a href="ncGraphCreate.html">ncGraphCreate</a></td>
      <td>Initializes a <a href="ncGraphHandle_t.html">ncGraphHandle_t</a> struct for use with the NCAPI.</td>
    </tr>
    <tr>
      <td><a href="ncGraphDestroy.html">ncGraphDestroy</a></td>
      <td>Destroys a graph handle and frees associated resources.</td>
    </tr>
    <tr>
      <td><a href="ncGraphQueueInference.html">ncGraphQueueInference</a></td>
      <td>Queues an inference from a network graph.</td>
    </tr>
    <tr>
      <td><a href="ncGraphGetOption.html">ncGraphGetOption</a></td>
      <td>Gets the value of an option for a graph.</td>
    </tr>
    <tr>
      <td><a href="ncGraphSetOption.html">ncGraphSetOption</a></td>
      <td>Sets the value of an option for a graph.</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th>Convenience Functions</th>
      <th> </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="ncGraphAllocateWithFifos.html">ncGraphAllocateWithFifos</a></td>
      <td>Allocates a network graph and creates and allocates associated FIFOs with default options.</td>
    </tr>
    <tr>
      <td><a href="ncGraphAllocateWithFifosEx.html">ncGraphAllocateWithFifosEx</a></td>
      <td>Allocates a network graph and creates and allocates associated FIFOs with explicit options.</td>
    </tr>
    <tr>
      <td><a href="ncGraphQueueInferenceWithFifoElem.html">ncGraphQueueInferenceWithFifoElem</a></td>
      <td>Writes an input tensor to a FIFO and queues an inference from a network graph.</td>
    </tr>
  </tbody>
</table>

<p><br /></p>

<h2 id="c-api-overview">C API Overview</h2>

<h3 id="1-import-the-ncapi">1. Import the NCAPI</h3>

<p>Import the <code class="highlighter-rouge">mvnc.h</code> header and anything else that you need.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;mvnc.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Every NCAPI function will return a status code that should normally be NC_OK</span>
    <span class="n">ncStatus_t</span> <span class="n">retCode</span><span class="p">;</span>
<span class="p">...</span>
</code></pre></div></div>

<p>You can get and set application-level information and options with <a href="ncGlobalGetOption.html">ncGlobalGetOption()</a> and <a href="ncGlobalSetOption.html">ncGlobalSetOption()</a>.</p>

<h3 id="2-set-up-a-neural-compute-device">2. Set up a neural compute device</h3>

<p>The <a href="ncDeviceHandle_t.html">ncDeviceHandle_t</a> struct is used to represent a neural compute device throughout the NCAPI. The NCAPI provides functions to communicate with the device.</p>

<p>Initialize a device handle with <a href="ncDeviceCreate.html">ncDeviceCreate()</a>.</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">// Create a device handle for the first device found (index 0)</span>
    <span class="k">struct</span> <span class="n">ncDeviceHandle_t</span><span class="o">*</span> <span class="n">deviceHandle</span><span class="p">;</span>
    <span class="n">retCode</span> <span class="o">=</span> <span class="n">ncDeviceCreate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">deviceHandle</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">retCode</span> <span class="o">!=</span> <span class="n">NC_OK</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Error [%d]: Could not create a neural compute device handle.</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">retCode</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>Boot and initialize the neural compute device and open communication with <a href="ncDeviceOpen.html">ncDeviceOpen()</a>.</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">// Boot the device and open communication</span>
    <span class="n">retCode</span> <span class="o">=</span> <span class="n">ncDeviceOpen</span><span class="p">(</span><span class="n">deviceHandle</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">retCode</span> <span class="o">!=</span> <span class="n">NC_OK</span><span class="p">)</span> <span class="p">{</span>  
        <span class="n">printf</span><span class="p">(</span><span class="s">"Error [%d]: Could not open the neural compute device.</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">retCode</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>You can get information about the device using <a href="ncDeviceGetOption.html">ncDeviceGetOption()</a> for options in the <a href="ncDeviceOption_t.html">ncDeviceOption_t</a> enumeration.</p>

<p>*Note: If you are using more than one neural compute device, you must create and open a separate device handle for each.</p>

<h3 id="3-set-up-a-network-graph-and-associated-fifo-queues-for-the-device">3. Set up a network graph and associated FIFO queues for the device</h3>

<p>The NCSDK requires a neural network graph file compiled with the <a href="../../../tools/compile.html">mvNCCompile</a> NCSDK tool.
Many network models from <a href="../../../tensorflow.html">TensorFlow™</a> and <a href="../../../caffe.html">Caffe</a> are supported.
See <a href="../../../configure_network.html">Configuring Your Network for the Intel® Movidius™ Neural Compute SDK</a> for more information about preparing your network model for use with the NCSDK.</p>

<p>When you have a compiled graph, load the graph file data to a buffer.</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">// Load the graph file into a buffer</span>
    <span class="c1">// void* graphFileBuffer = ...</span>
    <span class="c1">// unsigned int graphFileLength = ...</span>
</code></pre></div></div>

<p>The <a href="ncGraphHandle_t.html">ncGraphHandle_t</a> struct is used to represent a neural network graph throughout the NCAPI. The NCAPI provides functions to perform inferences using the graph.</p>

<p>Initialize the graph handle with a name string. The name string can be anything you like up to NC_MAX_NAME_SIZE characters, or just an empty string. You can read this name later with <a href="ncGraphGetOption.html">ncGraphGetOption()</a>.</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">// Initialize a graph handle</span>
    <span class="k">struct</span> <span class="n">ncGraphHandle_t</span><span class="o">*</span> <span class="n">graphHandle</span><span class="p">;</span>
    <span class="n">retCode</span> <span class="o">=</span> <span class="n">ncGraphCreate</span><span class="p">(</span><span class="s">"graph1"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">graphHandle</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">retCode</span> <span class="o">!=</span> <span class="n">NC_OK</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Error [%d]: Could not create a graph handle.</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">retCode</span><span class="p">);</span>
        <span class="c1">// Do clean up...</span>
        <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>Graph input and output is done with FIFO (first-in, first-out) queues. The <a href="ncFifoHandle_t.html">ncFifoHandle_t</a> struct is used to represent a FIFO throughout the NCAPI. The NCAPI provides functions for managing FIFO queues.</p>

<p>Create input and output FIFO queues for the graph using default FIFO options and allocate the graph to the device with <a href="ncGraphAllocateWithFifos.html">ncGraphAllocateWithFifos()</a>.</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">// Allocate the graph to the device and create input and output FIFOs with default options</span>
    <span class="k">struct</span> <span class="n">ncFifoHandle_t</span><span class="o">*</span> <span class="n">inFifoHandle</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">ncFifoHandle_t</span><span class="o">*</span> <span class="n">outFifoHandle</span><span class="p">;</span>
    <span class="n">retCode</span> <span class="o">=</span> <span class="n">ncGraphAllocateWithFifos</span><span class="p">(</span><span class="n">deviceHandle</span><span class="p">,</span> <span class="n">graphHandle</span><span class="p">,</span> <span class="n">graphFileBuffer</span><span class="p">,</span> 
                                       <span class="n">graphFileLength</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">inFifoHandle</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">outFifoHandle</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">retCode</span> <span class="o">!=</span> <span class="n">NC_OK</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Error [%d]: Could not allocate graph with FIFOs.</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">retCode</span><span class="p">);</span>
        <span class="c1">// Do clean up...</span>
        <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">free</span><span class="p">(</span><span class="n">graphFileBuffer</span><span class="p">);</span>
</code></pre></div></div>
<p>You can also use <a href="ncGraphAllocateWithFifosEx.html">ncGraphAllocateWithFifosEx()</a> to explicitly set FIFO options for type, data type, and size. See the <a href="ncFifoHandle_t.html">ncFifoHandle_t</a> documentation for more information on creating and allocating FIFOs.</p>

<p>You can get information about a graph using <a href="ncGraphGetOption.html">ncGraphGetOption()</a> for options in the <a href="ncGraphOption_t.html">ncGraphOption_t</a> enumeration. You can get information about a FIFO using <a href="ncFifoGetOption.html">ncFifoGetOption()</a> for options in the <a href="ncFifoOption_t.html">ncFifoOption_t</a> enumeration.</p>

<p>*Note: You must create and allocate a graph handle for each network graph file that you wish to use. A neural compute device can have more than one graph allocated to it, but each graph can only be allocated to a single device.</p>

<h3 id="4-get-an-input-tensor">4. Get an input tensor</h3>

<p>The way that you obtain and pre-process your input tensor will depend on your individual application. OpenCV and GStreamer are popular libraries for loading and manipulating images from file or a camera stream.</p>

<p>Input tensor data must be the data type specified by the <a href="ncFifoOption_t.html">NC_RW_FIFO_DATA_TYPE</a> option for the input FIFO. The default is 32-bit floating point, but FIFOs can also be configured to store 16-bit floating point data. See the <a href="ncFifoDataType_t.html">ncFifoDataType_t.html</a> enumeration.</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">// Load an input tensor and do pre-processing...</span>
    <span class="c1">// float* imageBuffer = ...</span>
    <span class="c1">// unsigned int imageBufferLength = ...</span>
</code></pre></div></div>

<p>The NCSDK includes example applications that demonstrate image tensor pre-processing for several networks.</p>

<h3 id="5-perform-an-inference">5. Perform an inference</h3>

<p>Use <a href="ncGraphQueueInferenceWithFifoElem.html">ncGraphQueueInferenceWithFifoElem()</a> to write the input tensor to your input FIFO and queue it for inference.
When the inference is complete the input tensor will be removed from the input FIFO and the result tensor will be placed in the output FIFO.
The third parameter is the size of the input tensor in bytes. This must match the expected size for the network.
The fourth parameter can be any data that you wish to have associated with this particular tensor when you read the inference result, such as the original tensor or a window handle, or NULL.</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">// Write the tensor to the input FIFO and queue an inference</span>
    <span class="n">retCode</span> <span class="o">=</span> <span class="n">ncGraphQueueInferenceWithFifoElem</span><span class="p">(</span>
                <span class="n">graphHandle</span><span class="p">,</span> <span class="n">inFifoHandle</span><span class="p">,</span> <span class="n">outFifoHandle</span><span class="p">,</span> <span class="n">imageBuffer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">imageBufferLength</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">retCode</span> <span class="o">!=</span> <span class="n">NC_OK</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Error [%d]: Could not write to the input FIFO and queue an inference.</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">retCode</span><span class="p">);</span>
        <span class="c1">// Do clean up...</span>
        <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>If the input FIFO is full, this function call will block until there is room to write to the FIFO.
You can check how many elements are in the input and output FIFOs with <a href="ncFifoGetOption.html">ncFifoGetOption()</a> for NC_RO_FIFO_WRITE_FILL_LEVEL and NC_RO_FIFO_READ_FILL_LEVEL, respectively.
Note that the inference will take some amount of time to complete, depending on network model speed and device communication latency, so you may need to wait to see updated levels.</p>

<p>After the inference is complete, you can get the inference result with <a href="ncFifoReadElem.html">ncFifoReadElem()</a>.
The size of the output tensor will depend on the network definition as well as the output FIFO’s data type.
You can calculate the size of the output tensor yourself or use <a href="ncFifoGetOption.html">ncFifoGetOption()</a> for NC_RO_FIFO_ELEMENT_DATA_SIZE to get the correct size.</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">// Get the size of the output tensor</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">outFifoElemSize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">optionSize</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">outFifoElemSize</span><span class="p">);</span>
    <span class="n">retCode</span> <span class="o">=</span> <span class="n">ncFifoGetOption</span><span class="p">(</span><span class="n">outFifoHandle</span><span class="p">,</span>  <span class="n">NC_RO_FIFO_ELEMENT_DATA_SIZE</span><span class="p">,</span>
                              <span class="o">&amp;</span><span class="n">outFifoElemSize</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">optionSize</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">retCode</span> <span class="o">!=</span> <span class="n">NC_OK</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Error [%d]: Could not get the output FIFO element data size.</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">retCode</span><span class="p">);</span>
        <span class="c1">// Do clean up...</span>
        <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
                    
    <span class="c1">// Get the output tensor</span>
    <span class="kt">float</span><span class="o">*</span> <span class="n">resultData</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)</span> <span class="n">malloc</span><span class="p">(</span><span class="n">outFifoElemSize</span><span class="p">);</span>
    <span class="kt">void</span><span class="o">*</span> <span class="n">userParam</span><span class="p">;</span>  <span class="c1">// this will be set to point to the user-defined data that you passed into ncGraphQueueInferenceWithFifoElem() with this tensor  </span>
    <span class="n">retCode</span> <span class="o">=</span> <span class="n">ncFifoReadElem</span><span class="p">(</span><span class="n">outFifoHandle</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">resultData</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">outFifoElemSize</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">userParam</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">retCode</span> <span class="o">!=</span> <span class="n">NC_OK</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Error [%d]: Could not read the result from the ouput FIFO.</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">retCode</span><span class="p">);</span>
        <span class="c1">// Do clean up...</span>
        <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>You can then use the output result as intended for your particular network model.</p>

<h3 id="6-clean-up">6. Clean up</h3>

<p>Before closing communication with the device, use <a href="ncGraphDestroy.html">ncGraphDestroy()</a> and <a href="ncFifoDestroy.html">ncFifoDestroy()</a> to set graph and FIFO handles to NULL and clean up associated memory. The FIFOs must be empty before being destroyed.
Then use <a href="ncDeviceClose.html">ncDeviceClose()</a> to close the device and <a href="ncDeviceDestroy.html">ncDeviceDestroy()</a> to set the device handle to NULL and clean up associated memory.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">// Clean up the FIFOs</span>
    <span class="n">ncFifoDestroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">inFifoHandle</span><span class="p">);</span>
    <span class="n">ncFifoDestroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">outFifoHandle</span><span class="p">);</span>
    
    <span class="c1">// Clean up the graph</span>
    <span class="n">ncGraphDestroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">graphHandle</span><span class="p">);</span>

    <span class="c1">// Close and clean up the device</span>
    <span class="n">ncDeviceClose</span><span class="p">(</span><span class="n">deviceHandle</span><span class="p">);</span>
    <span class="n">ncDeviceDestroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">deviceHandle</span><span class="p">);</span>
    
<span class="p">}</span>
</code></pre></div></div>


      </section>
    </div>
    <footer>
    
      
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    
  </body>
</html>
